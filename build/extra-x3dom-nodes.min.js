x3dom.registerNodeType("BooleanAnd","Boolean ",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.BooleanAnd.superClass.call(this,e),this.addField_SFBool("firstValue",!1),this.addField_SFBool("secondValue",!1),this.addField_SFBool("inputTrue",!1),this.addField_SFBool("inputFalse",!0)},{fieldChanged:function(e){("firstValue"===e||"secondValue"===e)&&(1==this._vf.firstValue&&1==this._vf.secondValue?(this._vf.inputTrue=!0,this._vf.inputFalse=!1,this.postMessage("inputTrue",!0),this.postMessage("inputFalse",!1)):(this._vf.inputTrue=!1,this._vf.inputFalse=!0,this.postMessage("inputTrue",!1),this.postMessage("inputFalse",!0)))}}));
x3dom.registerNodeType("BooleanOr","Boolean ",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.BooleanOr.superClass.call(this,e),this.addField_SFBool("fistValue",!1),this.addField_SFBool("secondValue",!1),this.addField_SFBool("inputTrue",!1),this.addField_SFBool("inputFalse",!0)},{fieldChanged:function(e){("firstValue"===e||"secondValue"===e)&&(1==this._vf.firstValue||1==this._vf.secondValue?(this._vf.inputTrue=!0,this._vf.inputFalse=!1,this.postMessage("inputTrue",!0),this.postMessage("inputFalse",!1)):(this._vf.inputTrue=!1,this._vf.inputFalse=!0,this.postMessage("inputTrue",!1),this.postMessage("inputFalse",!0)))}}));
x3dom.registerNodeType("DelaySensor","Time",defineClass(x3dom.nodeTypes.X3DSensorNode,function(e){x3dom.nodeTypes.DelaySensor.superClass.call(this,e),e?e.doc._nodeBag.timer.push(this):x3dom.debug.logWarning("TimeSensor: No runtime context found!"),this.addField_SFTime(e,"cycleInterval",1),this.addField_SFBool(e,"loop",!1),this.addField_SFTime(e,"additionalDelay",0),this.addField_SFTime(e,"delay",0);var i=(new Date).getTime()/1e3,t=this._vf.additionalDelay+this._vf.delay+i;this.addField_SFTime(e,"startTime",t),this.addField_SFTime(e,"delayCompleteTime",t),this.addField_SFBool(e,"delayComplete",!1),this.addField_SFTime(e,"stopTime",0),this.addField_SFTime(e,"pauseTime",0),this.addField_SFTime(e,"resumeTime",0),this.addField_SFTime(e,"cycleTime",0),this.addField_SFTime(e,"elapsedTime",0),this.addField_SFFloat(e,"fraction_changed",0),this.addField_SFBool(e,"isActive",!1),this.addField_SFBool(e,"isPaused",!1),this.addField_SFTime(e,"time",0),this.addField_SFBool(e,"first",!0),this.addField_SFFloat(e,"firstCycle",0),this._prevCycle=-1,this._lastTime=0,this._cycleStopTime=0,this._activatedTime=0,this._vf.startTime>0&&this._updateCycleStopTime(),this._backupStartTime=this._vf.startTime,this._backupStopTime=this._vf.stopTime,this._backupCycleInterval=this._vf.cycleInterval},{tick:function(e){if(!this._vf.enabled)return this._lastTime=e,!1;var i=this._vf.cycleInterval>0&&e>=this._vf.startTime&&(e<this._vf.stopTime||this._vf.stopTime<=this._vf.startTime)&&(1==this._vf.loop||0==this._vf.loop&&e<this._cycleStopTime);if(i&&!this._vf.isActive&&(this.postMessage("isActive",!0),this._vf.delayComplete=!0,this._vf.delayCompleteTime=this._vf.startTime,this.postMessage("delayComplete",!0),this.postMessage("delayCompleteTime",this._vf.startTime),this._activatedTime=e),i||this._vf.isActive){this.postMessage("elapsedTime",e-this._activatedTime);var t=e>=this._vf.pauseTime&&this._vf.pauseTime>this._vf.resumeTime;if(t&&!this._vf.isPaused?(this.postMessage("isPaused",!0),this.postMessage("pauseTime",e)):!t&&this._vf.isPaused&&(this.postMessage("isPaused",!1),this.postMessage("resumeTime",e)),!t){var s=this._getCycleAt(e),a=Math.floor(s),h=this._vf.startTime+a*this._vf.cycleInterval,l=0;this._vf.stopTime>this._vf.startTime&&this._lastTime<this._vf.stopTime&&e>=this._vf.stopTime?l=this._vf.stopTime:this._lastTime<h&&e>=h&&(l=h),l>0&&(e=l,s=this._getCycleAt(e),a=Math.floor(s));var d=s-a;d<x3dom.fields.Eps&&(d=this._lastTime<this._vf.startTime?0:1,this.postMessage("cycleTime",e)),this.postMessage("fraction_changed",d),this.postMessage("time",e)}}return!i&&this._vf.isActive&&this.postMessage("isActive",!1),this._lastTime=e,!0},fieldChanged:function(e){if("enabled"==e)!this._vf.enabled&&this._vf.isActive&&this.postMessage("isActive",!1);else if("isActive"==e)1==this._vf.isActive&&this.postMessage("delayCompleteTime",this._vf.startTime);else if("startTime"==e){if(this._vf.isActive)return void(this._vf.startTime=this._backupStartTime);this._backupStartTime=this._vf.startTime,this._updateCycleStopTime()}else if("stopTime"==e){if(this._vf.isActive&&this._vf.stopTime<=this._vf.startTime)return void(this._vf.stopTime=this._backupStopTime);this._backupStopTime=this._vf.stopTime}else if("cycleInterval"==e){if(this._vf.isActive)return void(this._vf.cycleInterval=this._backupCycleInterval);this._backupCycleInterval=this._vf.cycleInterval}else"loop"==e&&this._updateCycleStopTime()},parentRemoved:function(e){if(0===this._parentNodes.length)for(var i=this.findX3DDoc(),t=0,s=i._nodeBag.timer.length;s>t;t++)i._nodeBag.timer[t]===this&&i._nodeBag.timer.splice(t,1)},_getCycleAt:function(e){return Math.max(0,e-this._vf.startTime)/this._vf.cycleInterval},_updateCycleStopTime:function(){if(0==this._vf.loop){var e=(new Date).getTime()/1e3,i=Math.floor(this._getCycleAt(e))+1;this._cycleStopTime=this._vf.startTime+i*this._vf.cycleInterval}else this._cycleStopTime=0}}));
x3dom.registerNodeType("DistanceSensor","3DoorsSensor",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.DistanceSensor.superClass.call(this,e),this.addField_SFBool(e,"enabled",!0),this.addField_SFBool(e,"negated",!1),this.addField_SFBool(e,"triggerEvent",!1),this.addField_SFFloat(e,"distance",0),this.addField_SFVec3f(e,"element1Coordinates",0,0,0),this.addField_SFVec3f(e,"element2Coordinates",0,0,0)},{fieldChanged:function(e){("element1Coordinates"==e||"element2Coordinates"==e)&&this.calculateDistance()},calculateDistance:function(){var e=this._vf.element1Coordinates,t=this._vf.element2Coordinates,s=Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2);s=Math.sqrt(s),this._vf.negate?this._vf.distance>=s?(this._vf.triggerEvent=!1,this.postMessage("triggerEvent",!1)):(this._vf.triggerEvent=!0,this.postMessage("triggerEvent",!0)):this._vf.distance>=s?(this._vf.triggerEvent=!0,this.postMessage("triggerEvent",!0)):(this._vf.triggerEvent=!1,this.postMessage("triggerEvent",!1))}}));
x3dom.registerNodeType("BooleanFilter","Core",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.BooleanFilter.superClass.call(this,e),this.addField_SFBool(e,"inputTrue",!1),this.addField_SFBool(e,"inputFalse",!1),this.addField_SFBool(e,"inputNegate",!1),this.addField_SFBool(e,"set_boolean",!1)},{fieldChanged:function(e){"set_boolean"==e&&(1==this._vf[e]?(this.postMessage("inputNegate",!1),this.postMessage("inputTrue",!0),this.postMessage("inputFalse",!1)):(this.postMessage("inputNegate",!0),this.postMessage("inputTrue",!1),this.postMessage("inputFalse",!0)))}}));
x3dom.registerNodeType("BooleanToggle","Core",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.BooleanToggle.superClass.call(this,e),this.addField_SFBool(e,"toggle",!1),this.addField_SFBool(e,"set_boolean",!1)},{fieldChanged:function(e){"set_boolean"==e&&1==this._vf[e]&&(1==this._vf.toggle?this.postMessage("toggle",!1):this.postMessage("toggle",!0))}}));
x3dom.registerNodeType("BooleanSequencer","Core",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.BooleanSequencer.superClass.call(this,e),this.addField_SFFloat(e,"set_fraction",0),this.addField_SFBool(e,"value_changed",!1),this.addField_MFFloat(e,"key",[]),this.addField_MFBoolean(e,"keyValue",[]),console.log("ciao")},{fieldChanged:function(e){function o(e,o,t){if(e<=o[0])return t[0];if(e>=o[o.length-1])return t[o.length-1];for(var i=0;i<o.length-1;++i)if(o[i]<e&&e<=o[i+1])return t[i]}if("set_fraction"===e){var t=o(this._vf.set_fraction,this._vf.key,this._vf.keyValue);this.postMessage("value_changed",t)}}}));
x3dom.registerNodeType("IntegerSequencer","Core",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.IntegerSequencer.superClass.call(this,e),this.addField_SFFloat(e,"set_fraction",0),this.addField_SFInt32(e,"value_changed",!1),this.addField_MFFloat(e,"key",[]),this.addField_MFInt32(e,"keyValue",[])},{fieldChanged:function(e){function t(e,t,n){if(e<=t[0])return n[0];if(e>=t[t.length-1])return n[t.length-1];for(var i=0;i<t.length-1;++i)if(t[i]<e&&e<=t[i+1])return n[i]}if("set_fraction"===e){var n=t(this._vf.set_fraction,this._vf.key,this._vf.keyValue);this.postMessage("value_changed",n)}}}));
x3dom.registerNodeType("X3DTriggerNode","Triggers",defineClass(x3dom.nodeTypes.X3DChildNode,function(e){x3dom.nodeTypes.X3DTriggerNode.superClass.call(this,e)},{}));
x3dom.registerNodeType("BooleanTrigger","Triggers",defineClass(x3dom.nodeTypes.X3DTriggerNode,function(e){x3dom.nodeTypes.BooleanTrigger.superClass.call(this,e),this.addField_SFTime(e,"set_triggerTime",0),this.addField_SFBool(e,"triggerTrue",!1)},{fieldChanged:function(e){"set_triggerTime"==e&&this.postMessage("triggerTrue",!0)}}));
x3dom.registerNodeType("TimeTrigger","Triggers",defineClass(x3dom.nodeTypes.X3DTriggerNode,function(e){x3dom.nodeTypes.TimeTrigger.superClass.call(this,e),this.addField_SFBool(e,"set_boolean",!1),this.addField_SFTime(e,"triggerTime",0),this.ctx=e},{fieldChanged:function(e){if("set_boolean"==e){var i=(new Date).getTime()/1e3;this.postMessage("triggerTime",i)}}}));