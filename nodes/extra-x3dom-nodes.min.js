// Implementation of a simple boolean and that accept 2 boolean value and returns and 'outputTrue' value. 
// ### BooleanAnd ### 
x3dom.registerNodeType("BooleanAnd","Boolean ",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.BooleanAnd.superClass.call(this,e),this.addField_SFBool("firstValue",!1),this.addField_SFBool("secondValue",!1),this.addField_SFBool("outputTrue",!1),this.addField_SFBool("outputFalse",!0)},{fieldChanged:function(e){if(e==="firstValue"||e==="secondValue")this._vf.firstValue==1&&this._vf.secondValue==1?(this._vf.outputTrue=!0,this._vf.outputFalse=!1,this.postMessage("outputTrue",!0),this.postMessage("outputFalse",!1)):(this._vf.outputTrue=!1,this._vf.outputFalse=!0,this.postMessage("outputTrue",!1),this.postMessage("outputFalse",!0))}})),x3dom.registerNodeType("BooleanOr","Boolean ",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.BooleanOr.superClass.call(this,e),this.addField_SFBool("fistValue",!1),this.addField_SFBool("secondValue",!1),this.addField_SFBool("outputTrue",!1),this.addField_SFBool("outputFalse",!0)},{fieldChanged:function(e){if(e==="firstValue"||e==="secondValue")this._vf.firstValue==1||this._vf.secondValue==1?(this._vf.outputTrue=!0,this._vf.outputFalse=!1,this.postMessage("outputTrue",!0),this.postMessage("outputFalse",!1)):(this._vf.outputTrue=!1,this._vf.outputFalse=!0,this.postMessage("outputTrue",!1),this.postMessage("outputFalse",!0))}})),x3dom.registerNodeType("DelaySensor","Time",defineClass(x3dom.nodeTypes.X3DSensorNode,function(e){x3dom.nodeTypes.DelaySensor.superClass.call(this,e),e?e.doc._nodeBag.timer.push(this):x3dom.debug.logWarning("TimeSensor: No runtime context found!"),this.addField_SFTime(e,"cycleInterval",1),this.addField_SFBool(e,"loop",!1),this.addField_SFTime(e,"additionalDelay",0),this.addField_SFTime(e,"delay",0);var t=(new Date).getTime()/1e3,n=this._vf.additionalDelay+this._vf.delay+t;this.addField_SFTime(e,"startTime",n),this.addField_SFTime(e,"delayCompleteTime",n),this.addField_SFBool(e,"delayComplete",!1),this.addField_SFTime(e,"stopTime",0),this.addField_SFTime(e,"pauseTime",0),this.addField_SFTime(e,"resumeTime",0),this.addField_SFTime(e,"cycleTime",0),this.addField_SFTime(e,"elapsedTime",0),this.addField_SFFloat(e,"fraction_changed",0),this.addField_SFBool(e,"isActive",!1),this.addField_SFBool(e,"isPaused",!1),this.addField_SFTime(e,"time",0),this.addField_SFBool(e,"first",!0),this.addField_SFFloat(e,"firstCycle",0),this._prevCycle=-1,this._lastTime=0,this._cycleStopTime=0,this._activatedTime=0,this._vf.startTime>0&&this._updateCycleStopTime(),this._backupStartTime=this._vf.startTime,this._backupStopTime=this._vf.stopTime,this._backupCycleInterval=this._vf.cycleInterval},{tick:function(e){if(!this._vf.enabled)return this._lastTime=e,!1;var t=this._vf.cycleInterval>0&&e>=this._vf.startTime&&(e<this._vf.stopTime||this._vf.stopTime<=this._vf.startTime)&&(this._vf.loop==1||this._vf.loop==0&&e<this._cycleStopTime);t&&!this._vf.isActive&&(this.postMessage("isActive",!0),this._vf.delayComplete=!0,this._vf.delayCompleteTime=this._vf.startTime,this.postMessage("delayComplete",!0),this.postMessage("delayCompleteTime",this._vf.startTime),this._activatedTime=e);if(t||this._vf.isActive){this.postMessage("elapsedTime",e-this._activatedTime);var n=e>=this._vf.pauseTime&&this._vf.pauseTime>this._vf.resumeTime;n&&!this._vf.isPaused?(this.postMessage("isPaused",!0),this.postMessage("pauseTime",e)):!n&&this._vf.isPaused&&(this.postMessage("isPaused",!1),this.postMessage("resumeTime",e));if(!n){var r=this._getCycleAt(e),i=Math.floor(r),s=this._vf.startTime+i*this._vf.cycleInterval,o=0;this._vf.stopTime>this._vf.startTime&&this._lastTime<this._vf.stopTime&&e>=this._vf.stopTime?o=this._vf.stopTime:this._lastTime<s&&e>=s&&(o=s),o>0&&(e=o,r=this._getCycleAt(e),i=Math.floor(r));var u=r-i;u<x3dom.fields.Eps&&(u=this._lastTime<this._vf.startTime?0:1,this.postMessage("cycleTime",e)),this.postMessage("fraction_changed",u),this.postMessage("time",e)}}return!t&&this._vf.isActive&&this.postMessage("isActive",!1),this._lastTime=e,!0},fieldChanged:function(e){if(e=="enabled")!this._vf.enabled&&this._vf.isActive&&this.postMessage("isActive",!1);else if(e=="isActive")this._vf.isActive==1&&this.postMessage("delayCompleteTime",this._vf.startTime);else if(e=="startTime"){if(this._vf.isActive){this._vf.startTime=this._backupStartTime;return}this._backupStartTime=this._vf.startTime,this._updateCycleStopTime()}else if(e=="stopTime"){if(this._vf.isActive&&this._vf.stopTime<=this._vf.startTime){this._vf.stopTime=this._backupStopTime;return}this._backupStopTime=this._vf.stopTime}else if(e=="cycleInterval"){if(this._vf.isActive){this._vf.cycleInterval=this._backupCycleInterval;return}this._backupCycleInterval=this._vf.cycleInterval}else e=="loop"&&this._updateCycleStopTime()},parentRemoved:function(e){if(this._parentNodes.length===0){var t=this.findX3DDoc();for(var n=0,r=t._nodeBag.timer.length;n<r;n++)t._nodeBag.timer[n]===this&&t._nodeBag.timer.splice(n,1)}},_getCycleAt:function(e){return Math.max(0,e-this._vf.startTime)/this._vf.cycleInterval},_updateCycleStopTime:function(){if(this._vf.loop==0){var e=(new Date).getTime()/1e3,t=Math.floor(this._getCycleAt(e))+1;this._cycleStopTime=this._vf.startTime+t*this._vf.cycleInterval}else this._cycleStopTime=0}})),x3dom.registerNodeType("DistanceSensor","3DoorsSensor",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.DistanceSensor.superClass.call(this,e),this.addField_SFBool(e,"enabled",!0),this.addField_SFBool(e,"negated",!1),this.addField_SFBool(e,"triggerEvent",!1),this.addField_SFFloat(e,"distance",0),this.addField_SFVec3f(e,"element1Coordinates",0,0,0),this.addField_SFVec3f(e,"element2Coordinates",0,0,0)},{fieldChanged:function(e){(e=="element1Coordinates"||e=="element2Coordinates")&&this.calculateDistance()},calculateDistance:function(){var e=this._vf.element1Coordinates,t=this._vf.element2Coordinates,n=Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)+Math.pow(e.z-t.z,2);n=Math.sqrt(n),this._vf.negate?this._vf.distance>=n?(this._vf.triggerEvent=!1,this.postMessage("triggerEvent",!1)):(this._vf.triggerEvent=!0,this.postMessage("triggerEvent",!0)):this._vf.distance>=n?(this._vf.triggerEvent=!0,this.postMessage("triggerEvent",!0)):(this._vf.triggerEvent=!1,this.postMessage("triggerEvent",!1))}})),x3dom.registerNodeType("BooleanFilter","Core",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.BooleanFilter.superClass.call(this,e),this.addField_SFBool(e,"inputTrue",!1),this.addField_SFBool(e,"inputFalse",!1),this.addField_SFBool(e,"inputNegate",!1),this.addField_SFBool(e,"set_boolean",!1)},{fieldChanged:function(e){e=="set_boolean"&&(this._vf[e]==1?(this.postMessage("inputNegate",!1),this.postMessage("inputTrue",!0),this.postMessage("inputFalse",!1)):(this.postMessage("inputNegate",!0),this.postMessage("inputTrue",!1),this.postMessage("inputFalse",!0)))}})),x3dom.registerNodeType("BooleanToggle","Core",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.BooleanToggle.superClass.call(this,e),this.addField_SFBool(e,"toggle",!1),this.addField_SFBool(e,"set_boolean",!1)},{fieldChanged:function(e){e=="set_boolean"&&this._vf[e]==1&&(this._vf["toggle"]==1?this.postMessage("toggle",!1):this.postMessage("toggle",!0))}})),x3dom.registerNodeType("BooleanSequencer","Core",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.BooleanSequencer.superClass.call(this,e),this.addField_SFFloat(e,"set_fraction",0),this.addField_SFBool(e,"value_changed",!1),this.addField_MFFloat(e,"key",[]),this.addField_MFBoolean(e,"keyValue",[]),console.log("ciao")},{fieldChanged:function(e){function t(e,t,n){if(e<=t[0])return n[0];if(e>=t[t.length-1])return n[t.length-1];for(var r=0;r<t.length-1;++r)if(t[r]<e&&e<=t[r+1])return n[r]}if(e==="set_fraction"){var n=t(this._vf.set_fraction,this._vf.key,this._vf.keyValue);this.postMessage("value_changed",n)}}})),x3dom.registerNodeType("IntegerSequencer","Core",defineClass(x3dom.nodeTypes.X3DNode,function(e){x3dom.nodeTypes.IntegerSequencer.superClass.call(this,e),this.addField_SFFloat(e,"set_fraction",0),this.addField_SFInt32(e,"value_changed",!1),this.addField_MFFloat(e,"key",[]),this.addField_MFInt32(e,"keyValue",[])},{fieldChanged:function(e){function t(e,t,n){if(e<=t[0])return n[0];if(e>=t[t.length-1])return n[t.length-1];for(var r=0;r<t.length-1;++r)if(t[r]<e&&e<=t[r+1])return n[r]}if(e==="set_fraction"){var n=t(this._vf.set_fraction,this._vf.key,this._vf.keyValue);this.postMessage("value_changed",n)}}})),x3dom.registerNodeType("BooleanTrigger","Triggers",defineClass(x3dom.nodeTypes.X3DTriggerNode,function(e){x3dom.nodeTypes.BooleanTrigger.superClass.call(this,e),this.addField_SFTime(e,"set_triggerTime",0),this.addField_SFBool(e,"triggerTrue",!1)},{fieldChanged:function(e){e=="set_triggerTime"&&this.postMessage("triggerTrue",!0)}})),x3dom.registerNodeType("TimeTrigger","Triggers",defineClass(x3dom.nodeTypes.X3DTriggerNode,function(e){x3dom.nodeTypes.TimeTrigger.superClass.call(this,e),this.addField_SFBool(e,"set_boolean",!1),this.ctx=e},{fieldChanged:function(e){if(e=="set_boolean"){var t=(new Date).getTime()/1e3;this._vf["triggerTime"]==undefined?(console.log(t),this.addField_SFTime(this.ctx,"triggerTime",t)):this.postMessage("triggerTime",t)}}})),x3dom.registerNodeType("X3DTriggerNode","Triggers",defineClass(x3dom.nodeTypes.X3DChildNode,function(e){x3dom.nodeTypes.X3DTriggerNode.superClass.call(this,e)},{}));
